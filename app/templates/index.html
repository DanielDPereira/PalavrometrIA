<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>PalavrometrIA</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='chartjs.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container">
    <h1>PalavrometrIA</h1>
    <p class="subtitulo">Análise inteligente de textos e arquivos</p>

    <form method="POST" action="/" enctype="multipart/form-data">
      <textarea name="texto" placeholder="Digite ou cole o texto aqui...">{{ request.form.texto or '' }}</textarea>
      <p class="ou">ou</p>
      <input type="file" name="arquivo" accept=".txt,.pdf,.docx">
      <button type="submit">Analisar</button>
    </form>

    {% if resultado %}
      {% if resultado.erro %}
        <div class="erro">{{ resultado.erro }}</div>
      {% else %}
        <h2>Palavras Mais Frequentes</h2>
        <canvas id="freqPalavrasChart" width="600" height="400"></canvas>

        <div class="resultados">

          <h2>Idioma Detectado</h2>
          <div class="box">
            <p>{{ resultado.idioma }}</p>
          </div>

          <h2>Estatísticas do Texto</h2>
          <div class="box">
            <ul>
              <li>Total de palavras: {{ resultado.estatisticas.total_palavras }}</li>
              <li>Total de frases: {{ resultado.estatisticas.total_frases }}</li>
              <li>Palavras únicas: {{ resultado.estatisticas.palavras_unicas }}</li>
              <li>Média de palavras por frase: {{ resultado.estatisticas.media_palavras_por_frase }}</li>
              <li>Tamanho médio das palavras: {{ resultado.estatisticas.tamanho_medio_palavra }}</li>
            </ul>
          </div>

          <h2>Palavras-chave Principais</h2>
          <div class="box">
            <p>{{ resultado.palavras_chave | join(', ') }}</p>
          </div>

          <h2>Contagem por Tipo de Palavra</h2>
          <div class="box flex-row">
            <div class="tipo-lista">
              <ul>
                {% for tipo, qtd in resultado.tipos_palavras.items() %}
                  <li>{{ tipo }}: {{ qtd }}</li>
                {% endfor %}
              </ul>
            </div>
            <div class="tipo-grafico">
              <canvas id="tiposPalavrasChart" width="300" height="300"></canvas>
            </div>
          </div>

          <h2>Tempo Estimado de Leitura</h2>
          <div class="box">
            <p>{{ resultado.tempo_leitura }} minutos</p>
          </div>

          <h2>Grau de Legibilidade</h2>
          <div class="box">
            <p>{{ resultado.legibilidade }}</p>
          </div>

        </div>
      {% endif %}
    {% endif %}
  </div>

  <script>
    {% if resultado %}

    // Gráfico de Frequência de Palavras
    const freqCtx = document.getElementById('freqPalavrasChart')?.getContext('2d');
    if (freqCtx) {
      const labels = {{ resultado.freq_palavras | map(attribute=0) | list | tojson }};
      const data = {{ resultado.freq_palavras | map(attribute=1) | list | tojson }};

      new Chart(freqCtx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Frequência',
            data: data,
            backgroundColor: 'rgba(75, 192, 192, 0.6)'
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              precision: 0
            }
          }
        }
      });
    }

    // Gráfico classes gramaticais - pizza
    const tiposCtx = document.getElementById('tiposPalavrasChart')?.getContext('2d');
    if (tiposCtx) {
      const labelsTipos = {{ resultado.tipos_palavras.keys() | list | tojson }};
      const dataTipos = {{ resultado.tipos_palavras.values() | list | tojson }};

      new Chart(tiposCtx, {
        type: 'pie',
        data: {
          labels: labelsTipos,
          datasets: [{
            data: dataTipos,
            backgroundColor: [
              '#36A2EB', '#FF6384', '#FFCE56', '#4BC0C0', '#9966FF',
              '#FF9F40', '#8AFF33', '#33FFA8', '#FF3380', '#335BFF'
            ]
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'right' },
            title: {
              display: true,
              text: 'Contagem por Tipo de Palavra'
            }
          }
        }
      });
    }

    {% endif %}
  </script>
</body>
</html>
